<html>

<head>
  <link href="https://fonts.googleapis.com/css?family=Bangers&display=swap" rel="stylesheet">
  <title>Snek</title>
</head>

<body>
  <h1>S n e k</h1>
  <h2 class="points"></h2>
  <div><span id="easy"> Easy</span><span> </span><span id="medium"> Medium</span><span> </span><span id="hard"> Hard</span></div>
  <br />

  <style>
    html {
      text-align: center;
      font-family: 'Bangers', cursive;
      background-color: darkslategrey;
    }

    #easy,
    #medium,
    #hard {
      padding: 3px;
      background-color: rgb(66, 165, 91);
      font-size: 20px;
      text-align: center;
    }



    #easy:hover,
    #medium:hover,
    #hard:hover {
      cursor: pointer;
      background-color: red;
    }
  </style>
</body>

</html>

<script>
  var canvas = document.createElement("canvas");
  setInterval(update, 1000 / 15);

  canvas.style = "position:absolute; left:50%; width:400px; margin-left: -200px;";
  canvas.width = 420;
  canvas.height = 420;

  document.body.appendChild(canvas);

  document.addEventListener("keydown", keyPush);

  var ctx = canvas.getContext("2d");

  const rowSize = 20;
  const colSize = 20;

  var difficulty; // difficulty = 'easy' 'medium' 'hard'
  var gameState;
  var dead;
  // snake-----------------------
  var snakePos;
  var snakeDir;
  var snakeTrail;
  var snakeSize;

  // apple------------------------
  var applePos;

  // points-----------------------
  var points = 0;

  function setText() {
    ctx.fillStyle = 'white';
    ctx.font = "20px 'Montserrat', sans-serif"
    ctx.fillText('Press space to start', 125, 210);
  }

  function deathScreen() {
    ctx.fillStyle = 'red';
    ctx.font = "20px 'Montserrat', sans-serif"
    ctx.fillText('You lose', 170, 210);
  }

  function start() {
    gameState = 'start';
    if (dead == true) {
      deathScreen();
    } else {
      setText();
    }
  }

  start();

  function init() {
    points = 0;

    snakeDir = {
      x: 0,
      y: 0
    };

    if (difficulty != 'hard') {
      snakePos = {
        x: 10,
        y: 10
      };
    } else {
      snakePos = {
        x: 5,
        y: 5
      };
    }
    snakeTrail = [];

    snakeSize = 5;

    applePosRandomizer();
  }

  function update() {
    paintBg();

    switch (gameState) {
      case 'start':
        // difficulty selector
        document.getElementById("easy").addEventListener("click", easyMode);
        document.getElementById("medium").addEventListener("click", mediumMode);
        document.getElementById("hard").addEventListener("click", hardMode);
        if (difficulty != 'easy') {
          paintWall();
        }
        start();
        break;
      case 'playing': // playing state
        paintSnake();
        paintApple();
        if (difficulty != 'easy') {
          createWalls();
        }
        snakePos.x += snakeDir.x;
        snakePos.y += snakeDir.y;
        snakeMovement();
        snakeTrail.push({
          x: snakePos.x,
          y: snakePos.y
        });
        eatApple();
        if (snakeDir.x != 0 || snakeDir.y != 0) {
          checkCollisionSnake();
        }
        break;
      case 'death':
        start();
        break;
    }
    document.querySelector('.points').innerHTML = 'S c o r e :  ' + points;
  }

  // BACKGROUND----------------------------------------------------
  function paintBg() {
    ctx.fillStyle = "black";

    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  // SNAKE---------------------------------------------------------------
  function paintSnake() {
    ctx.fillStyle = "lime";

    for (var i = 0; i < snakeTrail.length; i++) {
      ctx.fillRect(snakeTrail[i].x * rowSize, snakeTrail[i].y * colSize, rowSize - 2, colSize - 2);
    }

    if (snakeTrail.length == snakeSize) {
      snakeTrail.shift();
    }
  }

// check snake collision with itself
  function checkCollisionSnake() {
    for (var i = snakeTrail.length - 2; i >= 0; i--) {
      if (snakeTrail[snakeTrail.length - 1].x == snakeTrail[i].x && snakeTrail[snakeTrail.length - 1].y == snakeTrail[i]
        .y) {
        gameState = 'death';
        dead = true;
      }
    }
  }

// snake movement edges
  function snakeMovement() {
    if (snakePos.x >= 21) {
      snakePos.x = 0;
    } else if (snakePos.x < 0) {
      snakePos.x = 21;
    }

    if (snakePos.y >= 21) {
      snakePos.y = 0;
    } else if (snakePos.y < 0) {
      snakePos.y = 21;
    }
  }

  // APPLE----------------------------------------------------------------------
  function paintApple() {
    ctx.fillStyle = "red";

    ctx.fillRect(applePos.x, applePos.y, rowSize - 2, colSize - 2);
  }

  function applePosRandomizer() {
    applePos = {
      x: Math.floor(Math.random() * (canvas.width / rowSize)) * rowSize,
      y: Math.floor(Math.random() * (canvas.height / colSize)) * colSize
    }

    for (var i = 0; i < snakeTrail.length; i++) {
      if (applePos.x / rowSize == snakeTrail[i].x && applePos.y / colSize == snakeTrail[i].y) {
        applePosRandomizer();
      }
    }

    if (difficulty == 'medium') {
      for (var i = 2; i < 8; i++) {
        if (applePos.x / rowSize == i && (applePos.y / colSize == 2 || applePos.y / colSize == 18)) {
          applePosRandomizer();
        }
        if ((applePos.x / rowSize == 2 || applePos.x / rowSize == 18) && applePos.y / colSize == i) {
          applePosRandomizer();
        }
      }

      for (var i = 12; i < 18; i++) {
        if (applePos.x / rowSize == i && (applePos.y / colSize == 2 || applePos.y / colSize == 18)) {
          applePosRandomizer();
        }
        if ((applePos.x / rowSize == 2 || applePos.x / rowSize == 18) && applePos.y / colSize == i) {
          applePosRandomizer();
        }
      }
    }

    if (difficulty == 'hard') {
      for (var i = 0; i <= rowSize; i++) {
        if ((applePos.x / rowSize == 10 && applePos.y / colSize == i) || (applePos.x / rowSize == i && applePos.y / colSize == 10)) {
          applePosRandomizer();
        }
      }
    }
  }

  function eatApple() {
    if (snakePos.x == applePos.x / rowSize && snakePos.y == applePos.y / colSize) {
      points++;
      snakeSize++;
      applePosRandomizer();
    }
  }

  // MODES--------------------------------------------------------------------------------
  function easyMode() {
    if (gameState != 'playing')
      difficulty = 'easy';
  }

  function mediumMode() {
    if (gameState != 'playing')
      difficulty = 'medium';
  }

  function hardMode() {
    if (gameState != 'playing')
      difficulty = 'hard';
  }

  // WALLS--------------------------------------------------------------------------------
  function createWalls() {
    paintWall();
    checkCollisionWall();
  }

  function paintWall() {
    ctx.fillStyle = "grey";
    if (difficulty == 'medium') {

      const xLeft = 2;
      const xRight = 18;
      const yUp = 2;
      const yDown = 18;

      for (var i = 2; i < 8; i++) {
        ctx.fillRect(xLeft * rowSize, i * colSize, rowSize - 2, colSize - 2); // vertical upper row left
        ctx.fillRect(i * rowSize, yUp * colSize, rowSize - 2, colSize - 2); // horizontal upper row left
        ctx.fillRect(xRight * rowSize, i * colSize, rowSize - 2, colSize - 2); // vertical upper row right
        ctx.fillRect(i * rowSize, yDown * colSize, rowSize - 2, colSize - 2); // horizontall down row left
      }

      for (var i = 18; i > 12; i--) {
        ctx.fillRect(i * rowSize, yUp * colSize, rowSize - 2, colSize - 2); // horizontal upper row right
        ctx.fillRect(xLeft * rowSize, i * colSize, rowSize - 2, colSize - 2); // vertical down row left
        ctx.fillRect(xRight * rowSize, i * colSize, rowSize - 2, colSize - 2); // vertical down row right
        ctx.fillRect(i * rowSize, yDown * colSize, rowSize - 2, colSize - 2); // horizontal down row right
      }
    }
    if (difficulty == 'hard') {
      const x = 10;
      const y = 10;

      for (var i = 0; i <= rowSize; i++) {
        ctx.fillRect(i * rowSize, y * colSize, rowSize - 2, colSize - 2);
        ctx.fillRect(x * rowSize, i * colSize, rowSize - 2, colSize - 2);
      }
    }
  }

  function checkCollisionWall() {
    if (difficulty == 'medium') {
      for (var i = 2; i < 8; i++) {
        if (snakePos.x == i && (snakePos.y == 2 || snakePos.y == 18)) { // up and down left collision
          gameState = 'death';
          dead = true;
        }
        if ((snakePos.x == 2 || snakePos.x == 18) && snakePos.y == i) { // left and right up collision
          gameState = 'death';
          dead = true;
        }
      }

      for (var i = 13; i < 19; i++) {
        if (snakePos.x == i && (snakePos.y == 2 || snakePos.y == 18)) { // up and down right collision
          gameState = 'death';
          dead = true;
        }
        if ((snakePos.x == 2 || snakePos.x == 18) && snakePos.y == i) { // left and right down collision
          gameState = 'death';
          dead = true;
        }
      }
    }

    if (difficulty == 'hard') {
      for (var i = 0; i <= rowSize; i++) {
        if (snakePos.x == i && snakePos.y == 10) {
          gameState = 'death';
          dead = true;
        }
        if (snakePos.y == i && snakePos.x == 10) {
          gameState = 'death';
          dead = true;
        }
      }
    }
  }

  // MOVEMENT----------------------------------------------------------------
  function keyPush(evt) {
    console.log({
      "Tecla pulsada: ": evt.keyCode
    });

    switch (evt.keyCode) {
      case 65:
      case 37: // LEFT
        if (snakeDir.x != 1) {
          snakeDir = {
            x: -1,
            y: 0
          };
        }
        break;
      case 87:
      case 38: // UP
        if (snakeDir.y != 1) {
          snakeDir = {
            x: 0,
            y: -1
          };
        }
        break;
      case 68:
      case 39: // RIGHT
        if (snakeDir.x != -1) {
          snakeDir = {
            x: 1,
            y: 0
          };
        }
        break;
      case 83:
      case 40: // DOWN
        if (snakeDir.y != -1) {
          snakeDir = {
            x: 0,
            y: 1
          };
        }
        break;
      case 32: // START GAME
        if (gameState == 'start') {
          gameState = 'playing';
          init();
          dead = false;
        }
        break;
    }
  }
</script>
